<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAX-MDW-UIUC Matcher</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css">
    <style>
        :root { --sw-blue: #304cb2; --sw-yellow: #ffbf27; --pc-blue: #004a99; }
        body { font-family: -apple-system, system-ui, sans-serif; background: #f0f2f5; margin: 0; padding: 15px; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
        .light-status { float: right; color: var(--sw-yellow); font-size: 24px; }
        h1 { font-size: 1.4rem; color: var(--sw-blue); margin-top: 0; display: flex; align-items: center; }
        label { display: block; font-weight: 600; margin: 10px 0 5px; font-size: 0.9rem; color: #555; }
        select, input, button { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; box-sizing: border-box; }
        button { background: var(--sw-blue); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.98); opacity: 0.9; }
        .match { border-left: 5px solid #4caf50; background: #f9fff9; padding: 15px; border-radius: 8px; margin-bottom: 12px; border: 1px solid #e0eee0; border-left-width: 6px; }
        .wait-tag { font-weight: bold; color: #2e7d32; }
        #loader { display: none; text-align: center; padding: 20px; color: #666; font-style: italic; }
    </style>
</head>
<body>

<div class="card">
    <span class="light-status mdi mdi-ceiling-light-multiple"></span>
    <h1>Travel Matcher</h1>
    
    <label>Date of Travel</label>
    <input type="date" id="dateInput">

    <label>Direction</label>
    <select id="route">
        <option value="LAX_UIUC">LAX ✈ MDW ➔ UIUC (Bus)</option>
        <option value="UIUC_LAX">UIUC (Bus) ➔ MDW ✈ LAX</option>
    </select>

    <button onclick="findMatches()">Search Schedules</button>
</div>

<div id="loader">Fetching live data...</div>
<div id="results"></div>

<script>
async function findMatches() {
    const date = document.getElementById('dateInput').value;
    const route = document.getElementById('route').value;
    const loader = document.getElementById('loader');
    const results = document.getElementById('results');

    if (!date) return alert("Select a date first.");
    
    results.innerHTML = "";
    loader.style.display = "block";

    // Simulating the SDE fetch logic for Southwest & Peoria Charter
    // Note: To bypass CORS, real implementations use a proxy like allorigins.win
    setTimeout(() => {
        loader.style.display = "none";
        
        // Example dynamic data that would be parsed from Southwest/Peoria
        const flights = [
            { id: "WN102", dep: "06:15", arr: "12:15" },
            { id: "WN504", dep: "10:30", arr: "16:40" },
            { id: "WN990", dep: "14:50", arr: "21:00" }
        ];
        
        const buses = [
            { id: "Bus-A", dep: "08:00", arr: "10:45" },
            { id: "Bus-B", dep: "13:30", arr: "16:15" },
            { id: "Bus-C", dep: "18:30", arr: "21:15" }
        ];

        let foundCount = 0;
        flights.forEach(f => {
            buses.forEach(b => {
                if (route === "LAX_UIUC") {
                    const wait = timeDiff(f.arr, b.dep);
                    if (wait >= 45) {
                        render(f, b, wait, "Wait at MDW", results);
                        foundCount++;
                    }
                } else {
                    const boarding = timeSub(f.dep, 30);
                    const gap = timeDiff(b.arr, boarding);
                    if (gap >= 60) {
                        render(b, f, gap, "Airport Buffer", results);
                        foundCount++;
                    }
                }
            });
        });

        if (foundCount === 0) results.innerHTML = "<p>No matches found within buffer constraints.</p>";
    }, 800);
}

function timeDiff(start, end) {
    const s = start.split(':').map(Number);
    const e = end.split(':').map(Number);
    return (e[0] * 60 + e[1]) - (s[0] * 60 + s[1]);
}

function timeSub(time, mins) {
    let [h, m] = time.split(':').map(Number);
    let total = h * 60 + m - mins;
    return `${Math.floor(total/60)}:${(total%60).toString().padStart(2, '0')}`;
}

function render(l1, l2, gap, label, container) {
    container.innerHTML += `
        <div class="card match">
            <strong>${l1.id} ➔ ${l2.id}</strong><br>
            <small>${l1.dep}-${l1.arr} | ${l2.dep}-${l2.arr}</small><br>
            <div class="wait-tag">${label}: ${gap} mins</div>
            <button style="padding:8px; margin-top:10px; font-size:0.8rem;" onclick="window.open('https://www.southwest.com')">Book on Southwest</button>
        </div>`;
}
</script>
</body>
</html>