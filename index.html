<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Travel Smarter">
    
    <title>Encino - UIUC Pro Planner</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css">
    
    <style>
        * { box-sizing: border-box; }

        :root { 
            --sw-blue: #304cb2; 
            --sw-yellow: #ffbf27; 
            --pc-blue: #004a99; 
            --success: #2e7d32; 
            --bg: #f4f7f6;
        }
        
        body { 
            font-family: -apple-system, system-ui, sans-serif;
            background: var(--bg); 
            margin: 0; 
            padding: 20px 16px; 
            color: #333;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .container { max-width: 440px; margin: 0 auto; width: 100%; }

        .card { 
            background: white; 
            border-radius: 16px; 
            padding: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.06); 
            margin-bottom: 15px;
            width: 100%;
        }

        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        h1 { font-size: 1.2rem; color: var(--sw-blue); margin: 0; font-weight: 800; }
        .light-icon { color: var(--sw-yellow); font-size: 26px; }

        label { font-size: 0.7rem; font-weight: 700; color: #888; text-transform: uppercase; display: block; margin-bottom: 6px; }

        input, select, button { 
            width: 100%; 
            max-width: 100%; 
            display: block;
            padding: 14px; 
            margin-bottom: 16px; 
            border: 1px solid #e0e0e0; 
            border-radius: 10px; 
            font-size: 16px; 
            background-color: #ffffff;
            -webkit-appearance: none;
        }

        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
            padding-right: 2.5rem;
        }

        button { background: var(--sw-blue); color: white; border: none; font-weight: 700; cursor: pointer; margin-top: 5px;}
        button:active { transform: scale(0.98); opacity: 0.9; }

        .match-card { 
            border: 1px solid #eee; 
            border-radius: 12px; 
            padding: 16px; 
            margin-bottom: 12px; 
            background: #fff; 
            width: 100%;
            overflow: hidden;
        }

        .best-value { border: 2px solid var(--success); background: #f0fff4; }
        
        .result-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
        .badge { background: var(--success); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.65rem; font-weight: bold; margin-bottom: 6px; display: inline-block; }
        
        .price-box { text-align: right; min-width: 95px; }
        .price { color: var(--success); font-weight: 800; font-size: 1.3rem; }
        .price-breakdown { font-size: 0.65rem; color: #777; margin-top: 4px; line-height: 1.2; }

        .date-header { font-size: 0.75rem; font-weight: 600; color: #999; margin-bottom: 2px; }
        
        .meta { 
            font-size: 0.85rem; 
            line-height: 1.6; 
            margin-top: 12px; 
            padding-top: 12px; 
            border-top: 1px solid #f0f0f0; 
        }
        .meta b { color: var(--sw-blue); }
        .wait-tag { color: #d32f2f; font-weight: bold; }

        #loader { display: none; text-align: center; color: #666; padding: 20px; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <div class="header-row">
            <h1>Travel Smarter</h1>
            <span class="mdi mdi-ceiling-light-multiple light-icon"></span>
        </div>
        
        <label>Target Date</label>
        <input type="date" id="targetDate">

        <label>Intended Departure</label>
        <input type="time" id="prefTime" value="09:00">

        <label>Route</label>
        <select id="direction">
            <option value="LAX_UIUC">LAX ✈ MDW ➔ UIUC (Bus)</option>
            <option value="UIUC_LAX">UIUC (Bus) ➔ MDW ✈ LAX</option>
        </select>

        <button onclick="runSmartSearch()">Find Best Connections</button>
    </div>

    <div id="loader">Calculating costs & timing...</div>
    <div id="results"></div>
</div>

<script>
async function runSmartSearch() {
    const targetDateStr = document.getElementById('targetDate').value;
    const prefTime = document.getElementById('prefTime').value;
    const direction = document.getElementById('direction').value;
    const resultsDiv = document.getElementById('results');
    const loader = document.getElementById('loader');

    if (!targetDateStr) return alert("Select a travel date first.");
    
    resultsDiv.innerHTML = "";
    loader.style.display = "block";

    const targetDate = new Date(targetDateStr + "T00:00:00");
    const dates = [
        new Date(targetDate.getTime() - 86400000).toISOString().split('T')[0],
        targetDateStr,
        new Date(targetDate.getTime() + 86400000).toISOString().split('T')[0]
    ];

    let allOptions = [];
    const shuttlePrice = 46.00;

    for (let dateStr of dates) {
        const dayOffset = (dateStr === targetDateStr) ? 0 : 1;
        
        const dailyFlights = [
            { id: "WN102", dep: "06:30", arr: "12:15", price: 145 },
            { id: "WN504", dep: "10:45", arr: "16:30", price: 115 },
            { id: "WN990", dep: "15:00", arr: "20:45", price: 175 },
            { id: "WN212", dep: "18:30", arr: "00:15", price: 95 }
        ];

        const dailyBuses = [
            { id: "PC805", dep: "08:05", arr: "10:50" },
            { id: "PC135", dep: "13:55", arr: "16:40" },
            { id: "PC181", dep: "18:15", arr: "21:00" },
            { id: "PC221", dep: "22:15", arr: "01:00" }
        ];

        dailyFlights.forEach(f => {
            dailyBuses.forEach(b => {
                let wait, finalArr, isValid = false;

                if (direction === "LAX_UIUC") {
                    wait = timeDiff(f.arr, b.dep);
                    finalArr = b.arr;
                    if (wait >= 45 && wait <= 240) isValid = true;
                } else {
                    const boarding = timeSub(f.dep, 30);
                    wait = timeDiff(b.arr, boarding);
                    finalArr = f.arr;
                    if (wait >= 60 && wait <= 240) isValid = true;
                }

                const [arrH, arrM] = finalArr.split(':').map(Number);
                const totalArrMins = arrH * 60 + arrM;
                if (totalArrMins < 540 || totalArrMins > 1320) isValid = false;

                if (isValid) {
                    const firstDep = direction === "LAX_UIUC" ? f.dep : b.dep;
                    const proxPenalty = Math.abs(timeDiff(prefTime, firstDep)) * 0.1;
                    const score = f.price + (wait * 0.2) + (dayOffset * 50) + proxPenalty;
                    
                    allOptions.push({ 
                        f, b, wait, dateStr, score, dayOffset, 
                        flightPrice: f.price, 
                        shuttlePrice: shuttlePrice,
                        totalPrice: f.price + shuttlePrice, 
                        finalArr 
                    });
                }
            });
        });
    }

    allOptions.sort((a, b) => a.score - b.score);
    loader.style.display = "none";
    
    if (allOptions.length === 0) {
        resultsDiv.innerHTML = "<div style='text-align:center; padding:20px; color:#888;'>No options found for the 9am-10pm window.</div>";
    } else {
        render(allOptions.slice(0, 5), resultsDiv, direction);
    }
}

function timeDiff(t1, t2) {
    const [h1, m1] = t1.split(':').map(Number);
    const [h2, m2] = t2.split(':').map(Number);
    return (h2 * 60 + m2) - (h1 * 60 + m1);
}

function timeSub(time, mins) {
    let [h, m] = time.split(':').map(Number);
    let total = (h * 60 + m) - mins;
    if (total < 0) total += 1440;
    return `${Math.floor(total/60)}:${(total%60).toString().padStart(2, '0')}`;
}

function render(options, container, direction) {
    options.forEach((opt, i) => {
        const isBest = i === 0;
        const leg1Label = direction === "LAX_UIUC" ? "Flight" : "Shuttle";
        const leg2Label = direction === "LAX_UIUC" ? "Shuttle" : "Flight";
        
        container.innerHTML += `
            <div class="match-card ${isBest ? 'best-value' : ''}">
                <div class="result-header">
                    <div style="flex: 1;">
                        ${isBest ? '<div class="badge">TOP PICK</div>' : ''}
                        <div class="date-header">${opt.dateStr} ${opt.dayOffset !== 0 ? '(±1 Day)' : ''}</div>
                        <div style="font-weight:700; color:var(--sw-blue);">${opt.f.id} + ${opt.b.id}</div>
                    </div>
                    <div class="price-box">
                        <div class="price">$${opt.totalPrice.toFixed(0)}</div>
                        <div class="price-breakdown">
                            Flight: $${opt.flightPrice.toFixed(0)}<br>
                            Shuttle: $${opt.shuttlePrice.toFixed(0)}
                        </div>
                    </div>
                </div>
                <div class="meta">
                    <b>Leg 1 (${leg1Label}):</b> ${direction === "LAX_UIUC" ? opt.f.dep + ' ➔ ' + opt.f.arr : opt.b.dep + ' ➔ ' + opt.b.arr}<br>
                    <b>Leg 2 (${leg2Label}):</b> ${direction === "LAX_UIUC" ? opt.b.dep + ' ➔ ' + opt.b.arr : opt.f.dep + ' ➔ ' + opt.f.arr}<br>
                    <b>MDW Wait:</b> <span class="wait-tag">${opt.wait} mins</span><br>
                    <b>Final Arrival:</b> <strong>${opt.finalArr}</strong>
                </div>
            </div>`;
    });
}
</script>
</body>
</html>
