<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Encino - UIUC Pro Planner</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css">
    <style>
        /* The "SDE Magic" - Prevents spilling by including padding in width */
        * { box-sizing: border-box; }

        :root { --sw-blue: #304cb2; --sw-yellow: #ffbf27; --pc-blue: #004a99; --success: #2e7d32; }
        
        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            background: #f4f7f6; 
            margin: 0; 
            padding: 12px; 
            color: #333;
            overflow-x: hidden; /* Strict horizontal containment */
        }

        .container { 
            max-width: 480px; 
            margin: 0 auto; 
            width: 100%; 
        }

        .card { 
            background: white; 
            border-radius: 12px; 
            padding: 16px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
            margin-bottom: 12px;
            width: 100%;
        }

        .header-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        
        h1 { font-size: 1.1rem; color: var(--sw-blue); margin: 0; }
        .light-icon { color: var(--sw-yellow); font-size: 24px; }

        label { font-size: 0.7rem; font-weight: bold; color: #666; text-transform: uppercase; display: block; margin-bottom: 4px; }

        /* Prevents iOS from zooming in on focus while keeping it within bounds */
        input, select, button { 
            width: 100%; 
            padding: 12px; 
            margin-bottom: 12px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            font-size: 16px; 
            display: block;
            background: #fff;
        }

        button { background: var(--sw-blue); color: white; border: none; font-weight: bold; cursor: pointer; }
        button:active { opacity: 0.8; }

        .match-card { 
            border: 1px solid #eee; 
            border-radius: 10px; 
            padding: 14px; 
            margin-bottom: 12px; 
            background: #fff; 
            width: 100%;
        }

        .best-value { border: 2px solid var(--success); background: #f0fff4; }
        
        /* Flex layout for the result header to prevent overlap */
        .result-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            gap: 10px;
        }

        .badge { 
            background: var(--success); 
            color: white; 
            padding: 2px 8px; 
            border-radius: 10px; 
            font-size: 0.65rem; 
            font-weight: bold;
            margin-bottom: 4px;
            display: inline-block;
        }

        .price-box { text-align: right; min-width: 80px; }
        .price { color: var(--success); font-weight: bold; font-size: 1.2rem; }
        .price small { display: block; font-size: 0.6rem; color: #666; font-weight: normal; }

        .date-header { font-size: 0.75rem; font-weight: bold; color: #888; }

        .meta { 
            font-size: 0.85rem; 
            line-height: 1.5; 
            margin-top: 10px; 
            padding-top: 10px; 
            border-top: 1px solid #f0f0f0; 
        }

        #loader { display: none; text-align: center; color: #666; padding: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <div class="header-row">
            <h1>Travel Smarter</h1>
            <span class="mdi mdi-ceiling-light-multiple light-icon"></span>
        </div>
        
        <label>Target Date</label>
        <input type="date" id="targetDate">

        <label>Intended Departure</label>
        <input type="time" id="prefTime" value="09:00">

        <label>Route</label>
        <select id="direction">
            <option value="LAX_UIUC">LAX ✈ MDW ➔ UIUC (Bus)</option>
            <option value="UIUC_LAX">UIUC (Bus) ➔ MDW ✈ LAX</option>
        </select>

        <button onclick="runSmartSearch()">Find Best Connections</button>
    </div>

    <div id="loader">Filtering for 9am-10pm window...</div>
    <div id="results"></div>
</div>

<script>
async function runSmartSearch() {
    const targetDateStr = document.getElementById('targetDate').value;
    const prefTime = document.getElementById('prefTime').value;
    const direction = document.getElementById('direction').value;
    const resultsDiv = document.getElementById('results');
    const loader = document.getElementById('loader');

    if (!targetDateStr) return alert("Please select a date.");
    
    resultsDiv.innerHTML = "";
    loader.style.display = "block";

    const targetDate = new Date(targetDateStr + "T00:00:00");
    const dates = [
        new Date(targetDate.getTime() - 86400000).toISOString().split('T')[0],
        targetDateStr,
        new Date(targetDate.getTime() + 86400000).toISOString().split('T')[0]
    ];

    let allOptions = [];
    const shuttlePrice = 46.00;

    for (let dateStr of dates) {
        const dayOffset = (dateStr === targetDateStr) ? 0 : 1;
        
        // Flight simulation (In a live app, this replaces with your scraper data)
        const dailyFlights = [
            { id: "WN454", dep: "06:30", arr: "12:15", price: 145 },
            { id: "WN221", dep: "10:45", arr: "16:30", price: 115 },
            { id: "WN889", dep: "15:00", arr: "20:45", price: 175 },
            { id: "WN991", dep: "18:30", arr: "00:15", price: 95 }
        ];

        const dailyBuses = [
            { id: "PC-Early", dep: "08:05", arr: "10:50" },
            { id: "PC-Noon", dep: "13:55", arr: "16:40" },
            { id: "PC-Late", dep: "18:15", arr: "21:00" },
            { id: "PC-Night", dep: "22:15", arr: "01:00" }
        ];

        dailyFlights.forEach(f => {
            dailyBuses.forEach(b => {
                let wait, finalArr, isValid = false;

                if (direction === "LAX_UIUC") {
                    wait = timeDiff(f.arr, b.dep);
                    finalArr = b.arr;
                    if (wait >= 45 && wait <= 240) isValid = true;
                } else {
                    const boarding = timeSub(f.dep, 30);
                    wait = timeDiff(b.arr, boarding);
                    finalArr = f.arr;
                    if (wait >= 60 && wait <= 240) isValid = true;
                }

                // 9am-10pm Arrival filter
                const [arrH, arrM] = finalArr.split(':').map(Number);
                const totalArrMins = arrH * 60 + arrM;
                if (totalArrMins < 540 || totalArrMins > 1320) isValid = false;

                if (isValid) {
                    const firstDep = direction === "LAX_UIUC" ? f.dep : b.dep;
                    const proxPenalty = Math.abs(timeDiff(prefTime, firstDep)) * 0.1;
                    const score = f.price + (wait * 0.2) + (dayOffset * 50) + proxPenalty;
                    
                    allOptions.push({ f, b, wait, dateStr, score, dayOffset, totalPrice: f.price + shuttlePrice, finalArr });
                }
            });
        });
    }

    allOptions.sort((a, b) => a.score - b.score);
    loader.style.display = "none";
    
    if (allOptions.length === 0) {
        resultsDiv.innerHTML = "<div style='text-align:center; padding:20px;'>No matches found in the 9am-10pm window.</div>";
    } else {
        render(allOptions.slice(0, 5), resultsDiv);
    }
}

function timeDiff(t1, t2) {
    const [h1, m1] = t1.split(':').map(Number);
    const [h2, m2] = t2.split(':').map(Number);
    return (h2 * 60 + m2) - (h1 * 60 + m1);
}

function timeSub(time, mins) {
    let [h, m] = time.split(':').map(Number);
    let total = (h * 60 + m) - mins;
    if (total < 0) total += 1440;
    return `${Math.floor(total/60)}:${(total%60).toString().padStart(2, '0')}`;
}

function render(options, container) {
    options.forEach((opt, i) => {
        const isBest = i === 0;
        container.innerHTML += `
            <div class="match-card ${isBest ? 'best-value' : ''}">
                <div class="result-header">
                    <div style="flex: 1;">
                        ${isBest ? '<div class="badge">TOP PICK</div>' : ''}
                        <div class="date-header">${opt.dateStr} ${opt.dayOffset !== 0 ? '(±1 Day)' : ''}</div>
                        <div style="font-weight:bold; color:var(--sw-blue);">${opt.f.id} + ${opt.b.id}</div>
                    </div>
                    <div class="price-box">
                        <div class="price">$${opt.totalPrice.toFixed(0)}</div>
                        <small>Total Trip</small>
                    </div>
                </div>
                <div class="meta">
                    <b>Leg 1:</b> ${opt.f.dep} ➔ ${opt.f.arr}<br>
                    <b>Leg 2:</b> ${opt.b.dep} ➔ ${opt.b.arr}<br>
                    <b>Arrive:</b> ${opt.finalArr}<br>
                    <b>Wait:</b> ${opt.wait} mins
                </div>
            </div>`;
    });
}
</script>
</body>
</html>
